<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BigClock - Digital Alarm Clock</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            overflow-x: hidden;
        }

        .clock-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .time-display {
            font-size: 180px;
            font-weight: bold;
            letter-spacing: 15px;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 20px;
        }

        .time-number {
            font-size: 180px;
        }

        .time-period {
            font-size: 60px;
            opacity: 0.6;
            font-weight: normal;
        }

        .date-display {
            font-size: 40px;
            margin-top: 30px;
            opacity: 0.9;
        }

        .timezone-display {
            font-size: 24px;
            margin-top: 15px;
            opacity: 0.7;
        }

        .alarm-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            min-width: 450px;
            max-width: 600px;
            display: none;
            position: fixed;
            bottom: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .alarm-section.visible {
            display: block;
        }

        .settings-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-50%) scale(1.05);
        }

        .close-settings {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.7;
        }

        .close-settings:hover {
            opacity: 1;
        }

        .alarm-header {
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }

        .alarm-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .control-label {
            font-size: 18px;
            flex-shrink: 0;
        }

        input[type="time"] {
            font-size: 20px;
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            padding: 12px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #0b7dda;
        }

        .alarm-status {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
        }

        .alarms-list {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .alarm-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 16px;
        }

        .alarm-item:last-child {
            margin-bottom: 0;
        }

        .alarm-item.disabled {
            opacity: 0.5;
        }

        .alarm-item-time {
            font-size: 24px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .alarm-item-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #4CAF50;
        }

        .toggle-slider {
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            left: 32px;
        }

        .audio-list {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .audio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 14px;
        }

        .audio-item:last-child {
            margin-bottom: 0;
        }

        .fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .alarm-ringing {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            animation: pulse 1s infinite;
        }

        .alarm-ringing.active {
            display: flex;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }

        .alarm-ringing .time-display {
            font-size: 150px;
            margin-bottom: 30px;
            display: block;
        }

        .alarm-ringing .alarm-message {
            font-size: 40px;
            margin-bottom: 40px;
        }

        .alarm-buttons {
            display: flex;
            gap: 20px;
        }

        .alarm-buttons .btn {
            font-size: 24px;
            padding: 20px 50px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
        }

        .volume-slider {
            flex-grow: 1;
        }

        .compact-status {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 30px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            font-size: 16px;
            pointer-events: none;
        }

        .compact-status.alarm-active {
            background: rgba(76, 175, 80, 0.3);
        }

        .instructions {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 13px;
            opacity: 0.8;
        }

        #audioPlayer {
            display: none;
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>

    <div class="clock-container">
        <div class="time-display">
            <span class="time-number" id="timeDisplay">00:00</span>
            <span class="time-period" id="timePeriod">AM</span>
        </div>
        <div class="date-display" id="dateDisplay">Loading...</div>
        <div class="timezone-display">Central Standard Time (CST)</div>
    </div>

    <!-- Settings Button -->
    <button class="settings-btn" id="settingsBtn" onclick="toggleSettings()">‚öôÔ∏è Alarm Settings</button>
    
    <!-- Compact Status (shows when settings closed) -->
    <div class="compact-status" id="compactStatus">‚ÑπÔ∏è No alarms set</div>

    <div class="alarm-section" id="alarmSection">
        <button class="close-settings" onclick="toggleSettings()">‚úï</button>
        <div class="alarm-header">‚è∞ Alarm Settings</div>
        
        <div class="alarm-controls">
            <div class="control-row">
                <span class="control-label">Set Alarm:</span>
                <input type="time" id="alarmTime" value="07:00">
                <button class="btn btn-primary btn-small" onclick="addAlarm()">+ Add</button>
            </div>

            <div class="alarms-list" id="alarmsList">
                <div style="text-align: center; opacity: 0.6;">No alarms set</div>
            </div>

            <div style="border-top: 2px solid rgba(255, 255, 255, 0.2); margin: 20px 0; padding-top: 20px;">
                <div style="font-size: 18px; margin-bottom: 15px; font-weight: bold;">Wake-up Music</div>
            </div>

            <div class="control-row">
                <span class="control-label">Audio Files:</span>
                <input type="file" id="audioFileInput" accept="audio/*" multiple onchange="addAudioFiles(this)">
                <button class="btn btn-secondary btn-small" onclick="document.getElementById('audioFileInput').click()">üìÅ Add MP3s</button>
            </div>

            <div class="instructions">
                üí° Click "Add MP3s" to select audio files from your computer. You can select multiple files at once. Supported: MP3, WAV, OGG, M4A
            </div>

            <div class="audio-list" id="audioList">
                <div style="text-align: center; opacity: 0.6;">No audio files added yet</div>
            </div>

            <div class="control-row">
                <span class="control-label">Volume:</span>
                <div class="volume-control">
                    <input type="range" class="volume-slider" id="volumeControl" min="0" max="100" value="80">
                    <span id="volumeDisplay">80%</span>
                </div>
            </div>

            <div class="control-row">
                <button class="btn btn-secondary btn-small" onclick="testMusic()">üîä Test Music</button>
                <button class="btn btn-secondary btn-small" onclick="clearAllAudio()">üóëÔ∏è Clear All</button>
            </div>
        </div>

        <div class="alarm-status" id="alarmStatus">
            ‚ÑπÔ∏è No alarms set
        </div>
    </div>

    <!-- Alarm Ringing Overlay -->
    <div class="alarm-ringing" id="alarmOverlay">
        <div class="time-display" id="alarmTimeDisplay">00:00:00 AM</div>
        <div class="alarm-message">‚è∞ WAKE UP! ‚è∞</div>
        <div class="alarm-buttons">
            <button class="btn btn-secondary" onclick="snoozeAlarm()">üò¥ Snooze (15 min)</button>
            <button class="btn btn-danger" onclick="dismissAlarm()">‚úì Dismiss</button>
        </div>
    </div>

    <!-- Audio Player -->
    <audio id="audioPlayer" loop></audio>

    <script>
        let alarms = []; // Array of {time: '07:00', enabled: true, id: timestamp}
        let alarmRinging = false;
        let currentAlarmId = null;
        let audioFiles = []; // Array of File objects
        let currentAudioIndex = 0;
        let audioPlayer = document.getElementById('audioPlayer');
        let snoozeCount = 0;

        // Get current CST time
        function getCSTTime() {
            const now = new Date();
            const cstTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Chicago' }));
            return cstTime;
        }

        // Update clock display
        function updateClock() {
            const now = getCSTTime();
            
            const hours24 = now.getHours();
            let hours = hours24;
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            // Convert to 12-hour format for display
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;
            const displayHours = String(hours).padStart(2, '0');
            
            const timeString = `${displayHours}:${minutes}`;
            document.getElementById('timeDisplay').textContent = timeString;
            document.getElementById('timePeriod').textContent = ampm;
            
            if (alarmRinging) {
                const seconds = String(now.getSeconds()).padStart(2, '0');
                let alarmHours = hours24;
                const alarmAmpm = alarmHours >= 12 ? 'PM' : 'AM';
                alarmHours = alarmHours % 12;
                alarmHours = alarmHours ? alarmHours : 12;
                const alarmDisplayHours = String(alarmHours).padStart(2, '0');
                const alarmTimeString = `${alarmDisplayHours}:${minutes}:${seconds} ${alarmAmpm}`;
                document.getElementById('alarmTimeDisplay').textContent = alarmTimeString;
            }
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('en-US', options);
            document.getElementById('dateDisplay').textContent = dateString;
            
            // Check if any alarm should trigger
            if (!alarmRinging) {
                const currentTime = `${String(hours24).padStart(2, '0')}:${minutes}`;
                const triggeredAlarm = alarms.find(alarm => alarm.enabled && alarm.time === currentTime);
                
                if (triggeredAlarm) {
                    currentAlarmId = triggeredAlarm.id;
                    triggerAlarm();
                }
            }
        }

        // Load saved settings
        function loadSettings() {
            const saved = localStorage.getItem('alarmSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                alarms = settings.alarms || [];
                
                // Note: Can't restore actual audio files from localStorage
                // User will need to re-add audio files each session
                
                updateAlarmsList();
                updateAlarmStatus();
            }
        }

        // Save settings
        function saveSettings() {
            const settings = {
                alarms: alarms
            };
            localStorage.setItem('alarmSettings', JSON.stringify(settings));
        }

        // Add audio files
        function addAudioFiles(input) {
            const files = Array.from(input.files);
            
            if (files.length === 0) return;
            
            files.forEach(file => {
                // Check if it's an audio file
                if (file.type.startsWith('audio/')) {
                    audioFiles.push(file);
                } else {
                    alert(`Skipped ${file.name} - not an audio file`);
                }
            });
            
            updateAudioList();
            input.value = ''; // Reset input
        }

        // Update audio list display
        function updateAudioList() {
            const list = document.getElementById('audioList');
            
            if (audioFiles.length === 0) {
                list.innerHTML = '<div style="text-align: center; opacity: 0.6;">No audio files added yet</div>';
                return;
            }
            
            list.innerHTML = audioFiles.map((file, index) => `
                <div class="audio-item">
                    <span>üéµ ${file.name}</span>
                    <button class="btn btn-danger btn-small" onclick="removeAudioFile(${index})">Remove</button>
                </div>
            `).join('');
        }

        // Remove audio file
        function removeAudioFile(index) {
            audioFiles.splice(index, 1);
            updateAudioList();
        }

        // Clear all audio
        function clearAllAudio() {
            if (audioFiles.length === 0) return;
            
            if (confirm('Remove all audio files?')) {
                audioFiles = [];
                updateAudioList();
            }
        }

        // Play random audio file
        function playRandomAudio() {
            if (audioFiles.length === 0) {
                console.error('No audio files available');
                return;
            }
            
            currentAudioIndex = Math.floor(Math.random() * audioFiles.length);
            const file = audioFiles[currentAudioIndex];
            
            const url = URL.createObjectURL(file);
            audioPlayer.src = url;
            audioPlayer.volume = document.getElementById('volumeControl').value / 100;
            audioPlayer.play();
            
            console.log('Playing:', file.name);
        }

        // Test music
        function testMusic() {
            if (audioFiles.length === 0) {
                alert('Please add at least one audio file first!');
                return;
            }
            
            playRandomAudio();
            
            setTimeout(() => {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
            }, 10000); // Play for 10 seconds
        }

        // Volume control
        document.getElementById('volumeControl').addEventListener('input', function() {
            const volume = this.value;
            document.getElementById('volumeDisplay').textContent = volume + '%';
            audioPlayer.volume = volume / 100;
        });

        // Toggle Settings Panel
        function toggleSettings() {
            const section = document.getElementById('alarmSection');
            const btn = document.getElementById('settingsBtn');
            const compactStatus = document.getElementById('compactStatus');
            
            section.classList.toggle('visible');
            
            if (section.classList.contains('visible')) {
                btn.style.display = 'none';
                compactStatus.style.display = 'none';
            } else {
                btn.style.display = 'block';
                compactStatus.style.display = 'block';
            }
        }

        // Add Alarm
        function addAlarm() {
            const timeInput = document.getElementById('alarmTime');
            const time = timeInput.value;
            
            if (!time) {
                alert('Please select a time for the alarm');
                return;
            }
            
            const exists = alarms.some(alarm => alarm.time === time);
            if (exists) {
                alert('An alarm already exists at this time');
                return;
            }
            
            if (audioFiles.length === 0) {
                alert('Please add at least one audio file for your alarm music!');
                return;
            }
            
            const newAlarm = {
                time: time,
                enabled: true,
                id: Date.now()
            };
            
            alarms.push(newAlarm);
            alarms.sort((a, b) => a.time.localeCompare(b.time));
            
            updateAlarmsList();
            updateAlarmStatus();
            saveSettings();
            
            timeInput.value = '07:00';
        }

        // Toggle alarm enabled/disabled
        function toggleAlarmEnabled(id) {
            const alarm = alarms.find(a => a.id === id);
            if (alarm) {
                alarm.enabled = !alarm.enabled;
                updateAlarmsList();
                updateAlarmStatus();
                saveSettings();
            }
        }

        // Remove alarm
        function removeAlarm(id) {
            alarms = alarms.filter(a => a.id !== id);
            updateAlarmsList();
            updateAlarmStatus();
            saveSettings();
        }

        // Update alarms list display
        function updateAlarmsList() {
            const list = document.getElementById('alarmsList');
            
            if (alarms.length === 0) {
                list.innerHTML = '<div style="text-align: center; opacity: 0.6;">No alarms set</div>';
                return;
            }
            
            list.innerHTML = alarms.map(alarm => {
                const [hours24, minutes] = alarm.time.split(':');
                let hours = parseInt(hours24) % 12;
                hours = hours ? hours : 12;
                const ampm = parseInt(hours24) >= 12 ? 'PM' : 'AM';
                const displayTime = `${hours}:${minutes} ${ampm}`;
                
                const statusClass = alarm.enabled ? '' : 'disabled';
                const statusIcon = alarm.enabled ? 'üîî' : 'üîï';
                
                return `
                    <div class="alarm-item ${statusClass}">
                        <span class="alarm-item-time">${statusIcon} ${displayTime}</span>
                        <div class="alarm-item-controls">
                            <div class="toggle-switch ${alarm.enabled ? 'active' : ''}" onclick="toggleAlarmEnabled(${alarm.id})">
                                <div class="toggle-slider"></div>
                            </div>
                            <button class="btn btn-danger btn-small" onclick="removeAlarm(${alarm.id})">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update alarm status display
        function updateAlarmStatus() {
            const status = document.getElementById('alarmStatus');
            const compactStatus = document.getElementById('compactStatus');
            
            let statusText, isActive;
            
            const enabledAlarms = alarms.filter(a => a.enabled);
            
            if (enabledAlarms.length > 0) {
                const audioCount = audioFiles.length;
                const audioText = audioCount > 0 ? `${audioCount} audio file${audioCount !== 1 ? 's' : ''}` : 'No audio files';
                
                const nextAlarm = getNextAlarm();
                if (nextAlarm) {
                    const [hours24, minutes] = nextAlarm.time.split(':');
                    let hours = parseInt(hours24) % 12;
                    hours = hours ? hours : 12;
                    const ampm = parseInt(hours24) >= 12 ? 'PM' : 'AM';
                    const displayTime = `${hours}:${minutes} ${ampm}`;
                    
                    statusText = `‚úÖ Next alarm: ${displayTime} | ${enabledAlarms.length} alarm${enabledAlarms.length !== 1 ? 's' : ''} active | ${audioText}`;
                } else {
                    statusText = `‚úÖ ${enabledAlarms.length} alarm${enabledAlarms.length !== 1 ? 's' : ''} active | ${audioText}`;
                }
                isActive = true;
            } else {
                statusText = '‚ÑπÔ∏è No alarms set';
                isActive = false;
            }
            
            status.innerHTML = statusText;
            compactStatus.innerHTML = statusText;
            
            if (isActive) {
                status.style.background = 'rgba(76, 175, 80, 0.3)';
                compactStatus.classList.add('alarm-active');
            } else {
                status.style.background = 'rgba(255, 255, 255, 0.2)';
                compactStatus.classList.remove('alarm-active');
            }
        }

        // Get next alarm to ring
        function getNextAlarm() {
            const now = getCSTTime();
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            const enabledAlarms = alarms.filter(a => a.enabled);
            
            let nextAlarm = enabledAlarms.find(a => a.time > currentTime);
            
            if (!nextAlarm && enabledAlarms.length > 0) {
                nextAlarm = enabledAlarms[0];
            }
            
            return nextAlarm;
        }

        // Initialize voice recognition
        // Trigger alarm
        function triggerAlarm() {
            if (alarmRinging) return;
            
            alarmRinging = true;
            snoozeCount = 0;
            document.getElementById('alarmOverlay').classList.add('active');
            
            // Play music
            if (audioFiles.length > 0) {
                playRandomAudio();
                console.log('Alarm triggered - music playing');
            } else {
                console.log('Alarm triggered - NO MUSIC (no audio files added)');
                alert('ALARM! (No music - please add audio files)');
            }
        }

        // Snooze alarm
        function snoozeAlarm() {
            snoozeCount++;
            alarmRinging = false;
            document.getElementById('alarmOverlay').classList.remove('active');
            
            // Stop music
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            
            // Calculate new alarm time
            const now = getCSTTime();
            now.setMinutes(now.getMinutes() + 15);
            
            const hours24 = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const newAlarmTime = `${String(hours24).padStart(2, '0')}:${minutes}`;
            
            // Convert to 12-hour format for display
            let displayHours = hours24 % 12;
            displayHours = displayHours ? displayHours : 12;
            const ampm = hours24 >= 12 ? 'PM' : 'AM';
            const displayTime = `${displayHours}:${minutes} ${ampm}`;
            
            // Add temporary snooze alarm
            const snoozeAlarm = {
                time: newAlarmTime,
                enabled: true,
                id: Date.now()
            };
            alarms.push(snoozeAlarm);
            
            alert(`Snoozed! Alarm will ring again at ${displayTime} (Snooze #${snoozeCount})`);
            
            // Remove snooze alarm after it triggers
            setTimeout(() => {
                alarms = alarms.filter(a => a.id !== snoozeAlarm.id);
                saveSettings();
            }, 16 * 60 * 1000);
        }

        // Dismiss alarm
        function dismissAlarm() {
            alarmRinging = false;
            snoozeCount = 0;
            currentAlarmId = null;
            document.getElementById('alarmOverlay').classList.remove('active');
            
            // Stop music
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            
            updateAlarmStatus();
        }

        // Fullscreen toggle
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // Initialize
        console.log('=== BigClock MP3 Version Starting ===');
        loadSettings();
        updateClock();
        setInterval(updateClock, 1000);
        
        // Make sure settings are hidden on load
        document.getElementById('alarmSection').classList.remove('visible');
        document.getElementById('settingsBtn').style.display = 'block';
        document.getElementById('compactStatus').style.display = 'block';
        
        console.log('BigClock ready! Add MP3 files to get started.');
    </script>
</body>
</html>
